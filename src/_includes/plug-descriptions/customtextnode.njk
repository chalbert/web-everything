{% from "mode-selector.njk" import pluggedContent, unpluggedContent, comparisonContent, endContent %}

<h3 id="overview">Overview</h3>
<p>
    <strong>CustomTextNode</strong> is the base class for enhanced text nodes with reactive binding capabilities, enabling custom template syntax and dynamic content updates.
</p>

<h3 id="interface">Interface</h3>
{% highlight "typescript" %}
abstract class CustomTextNode extends Text {
    // Instance Properties
    readonly options?: CustomTextNodeOptions;
    readonly parserName?: string;
    readonly determined: boolean;

    // Lifecycle Callbacks
    connectedCallback?(): void;
    disconnectedCallback?(): void;

    // Static Configuration
    static readonly observedAttributes?: string[];
}
{% endhighlight %}

<h3 id="key-concepts">Key Concepts</h3>
<dl class="ml-4 text-sm">
    <dt class="font-bold text-gray-800 mt-3">Undetermined Text Nodes</dt>
    <dd class="text-gray-600 ml-4">
        Text nodes with interpolation syntax (e.g., <code>{{ '{{value}}' }}</code>) start as "undetermined" and are upgraded to specific CustomTextNode types by parsers.
    </dd>

    <dt class="font-bold text-gray-800 mt-3">Reactive Bindings</dt>
    <dd class="text-gray-600 ml-4">
        CustomTextNode instances can subscribe to data changes and automatically update their textContent when dependencies change.
    </dd>
</dl>

<h3 id="usage-example">Usage Example</h3>

{{ pluggedContent("textnode-example", code=true) }}
{% highlight "javascript" %}
class InterpolationNode extends CustomTextNode {
    connectedCallback() {
        // Parse and subscribe to changes
        this.subscribe();
    }

    subscribe() {
        const context = this.getContext('data');
        this.textContent = context.value;
    }
}

// Register globally
customTextNodes.define('interpolation', InterpolationNode);
{% endhighlight %}

{{ unpluggedContent("textnode-example", code=true) }}
{% highlight "javascript" %}
consume {
  CustomTextNode,
  customTextNodes
} of '@web-expressions';

class InterpolationNode extends CustomTextNode {
    connectedCallback() {
        // Parse and subscribe to changes
        this.subscribe();
    }

    subscribe() {
        const context = getContext(this, 'data');
        this.textContent = context.value;
    }
}

// Register via consumed registry
customTextNodes.define('interpolation', InterpolationNode);
{% endhighlight %}

{{ comparisonContent("textnode-example", code=true) }}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
    <div>
        <div style="font-size: 0.7rem; font-weight: 600; color: #059669; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f0fdf4; border-bottom: 1px solid #e5e7eb;">Plugged</div>
{% highlight "javascript" %}
// Global availability
class InterpNode extends CustomTextNode {
  connectedCallback() {
    // ...
  }
}

customTextNodes.define(
  'interp', InterpNode
);
{% endhighlight %}
    </div>
    <div style="border-left: 1px solid #e5e7eb;">
        <div style="font-size: 0.7rem; font-weight: 600; color: #475569; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f8fafc; border-bottom: 1px solid #e5e7eb;">Unplugged</div>
{% highlight "javascript" %}
consume {
  CustomTextNode,
  customTextNodes
} of '@web-expressions';

class InterpNode extends CustomTextNode {
  connectedCallback() {
    // ...
  }
}

customTextNodes.define(
  'interp', InterpNode
);
{% endhighlight %}
    </div>
</div>

{{ endContent() }}

<p class="text-sm text-gray-600 mt-4">
    See <a href="/projects/webexpressions/">Web Expressions</a> for template syntax and binding patterns.
</p>
