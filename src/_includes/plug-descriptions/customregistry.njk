{% from "mode-selector.njk" import pluggedContent, unpluggedContent, comparisonContent, endContent %}

<h3 id="overview">Overview</h3>
<p>
    <strong>CustomRegistry</strong> is the abstract base class for all scoped registries in the Web Everything platform.
    It standardizes the API for storing and retrieving definitions while supporting inheritance from parent registries.
</p>

<h3 id="interface">Interface</h3>
{% highlight "typescript" %}
interface CustomRegistry<Definition, Key> {
    abstract readonly localName: string;

    // Core Registry API
    define(name: Key, definition: Definition): void;
    get(name: Key): Definition | undefined;
}
{% endhighlight %}

<h3 id="key-concepts">Key Concepts</h3>
<dl class="ml-4 text-sm">
    <dt class="font-bold text-gray-800 mt-3">Scoped Resolution</dt>
    <dd class="text-gray-600 ml-4">
        Each registry can have a parent registry. When looking up a definition, the registry first checks its own map, then delegates to its parent if not found.
    </dd>

    <dt class="font-bold text-gray-800 mt-3">Uniform Interface</dt>
    <dd class="text-gray-600 ml-4">
        All registries share the same core API: <code>define()</code> and <code>get()</code>.
    </dd>
</dl>

<h3 id="registry-hierarchy">Registry Hierarchy</h3>
<pre class="text-sm bg-gray-50 p-4 rounded border">
CustomRegistry (Abstract Base)
  ├─ HTMLRegistry (Abstract, for DOM-bound registries)
  │   ├─ CustomElementRegistry
  │   ├─ CustomAttributesRegistry
  │   ├─ CustomContextRegistry
  │   └─ ...
  └─ Other registries
</pre>

<h3 id="usage-example">Usage Example</h3>

{{ pluggedContent("registry-base-example", code=true) }}
{% highlight "javascript" %}
// Access a registry from an injector
const injector = element.getClosestInjector();
const registry = injector.get('customElements');

// Define a component in the scoped registry
registry.define('my-component', MyComponent);

// Retrieve a definition
const definition = registry.get('my-component');
{% endhighlight %}

{{ unpluggedContent("registry-base-example", code=true) }}
{% highlight "javascript" %}
consume {
  getClosestInjector
} of '@web-injectors';

// Access a registry from an injector
const injector = getClosestInjector(element);
const registry = injector.get('customElements');

// Define a component in the scoped registry
registry.define('my-component', MyComponent);

// Retrieve a definition
const definition = registry.get('my-component');
{% endhighlight %}

{{ comparisonContent("registry-base-example", code=true) }}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
    <div>
        <div style="font-size: 0.7rem; font-weight: 600; color: #059669; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f0fdf4; border-bottom: 1px solid #e5e7eb;">Plugged</div>
{% highlight "javascript" %}
const inj = el.getClosestInjector();
const reg = inj.get('customElements');
reg.define('my-comp', MyComp);
{% endhighlight %}
    </div>
    <div style="border-left: 1px solid #e5e7eb;">
        <div style="font-size: 0.7rem; font-weight: 600; color: #475569; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f8fafc; border-bottom: 1px solid #e5e7eb;">Unplugged</div>
{% highlight "javascript" %}
consume {
  getClosestInjector
} of '@web-injectors';

const inj = getClosestInjector(el);
const reg = inj.get('customElements');
reg.define('my-comp', MyComp);
{% endhighlight %}
    </div>
</div>

{{ endContent() }}
