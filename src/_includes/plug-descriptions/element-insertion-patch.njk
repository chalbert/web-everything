{% from "mode-selector.njk" import pluggedContent, unpluggedContent, comparisonContent, endContent %}

<h3 id="overview">Overview</h3>
<p>
    Patches DOM insertion methods to enable "lazy upgrade" of custom elements when they connect to the DOM.
</p>

<h3 id="patched-methods">Patched Methods</h3>
<ul class="list-disc ml-5 mb-4 text-sm text-gray-600">
    <li><code>append(...nodes)</code></li>
    <li><code>prepend(...nodes)</code></li>
    <li><code>after(...nodes)</code></li>
    <li><code>before(...nodes)</code></li>
    <li><code>replaceChildren(...nodes)</code></li>
    <li><code>replaceWith(...nodes)</code></li>
    <li><code>insertAdjacentElement(position, element)</code></li>
</ul>

<h3 id="usage-example">Usage Example</h3>

{{ pluggedContent("insertion-example", code=true) }}
{% highlight "javascript" %}
// All insertion methods are automatically patched
parent.append(myElement);
parent.prepend(anotherElement);
element.after(sibling);

// Elements are upgraded according to their
// scoped registry definitions on insertion
{% endhighlight %}

{{ unpluggedContent("insertion-example", code=true) }}
{% highlight "javascript" %}
consume {
  append,
  prepend,
  insertAfter
} of '@web-components';

// Use explicit functions for insertion
append(parent, myElement);
prepend(parent, anotherElement);
insertAfter(element, sibling);

// These handle proper upgrade and scope propagation
{% endhighlight %}

{{ comparisonContent("insertion-example", code=true) }}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
    <div>
        <div style="font-size: 0.7rem; font-weight: 600; color: #059669; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f0fdf4; border-bottom: 1px solid #e5e7eb;">Plugged</div>
{% highlight "javascript" %}
// Native methods, patched
parent.append(el);
parent.prepend(el);
el.after(sibling);
{% endhighlight %}
    </div>
    <div style="border-left: 1px solid #e5e7eb;">
        <div style="font-size: 0.7rem; font-weight: 600; color: #475569; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f8fafc; border-bottom: 1px solid #e5e7eb;">Unplugged</div>
{% highlight "javascript" %}
consume {
  append,
  prepend,
  insertAfter
} of '@web-components';

append(parent, el);
prepend(parent, el);
insertAfter(el, sibling);
{% endhighlight %}
    </div>
</div>

{{ endContent() }}

<p class="text-sm text-gray-600 mt-4">
    These patches enable lazy loading and scoped custom element definitions.
</p>
