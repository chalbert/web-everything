{% from "mode-selector.njk" import pluggedContent, unpluggedContent, comparisonContent, endContent %}

<h3 id="overview">Overview</h3>
<p>
    Patches <code>cloneNode</code> to properly preserve Custom Elements, Custom Comments, and Custom Text Nodes during cloning operations.
</p>

<h3 id="what-it-preserves">What it Preserves</h3>
<ul class="list-disc ml-5 mb-4 text-sm text-gray-600">
    <li><strong>Custom Elements:</strong> Reconstructs elements using their constructor with original options</li>
    <li><strong>Custom Comments:</strong> Preserves comment behavior prototypes and options</li>
    <li><strong>Custom Text Nodes:</strong> Maintains parser information and reactive bindings</li>
</ul>

<h3 id="usage-example">Usage Example</h3>

{{ pluggedContent("clonenode-example", code=true) }}
{% highlight "javascript" %}
// Clone with preserved prototypes and options
const clone = element.cloneNode(true);

// The cloned element retains its custom behavior
// and options from the original
console.log(clone.options); // Preserved!
{% endhighlight %}

{{ unpluggedContent("clonenode-example", code=true) }}
{% highlight "javascript" %}
consume { cloneNode } of '@web-components';

// Use the explicit clone function
const clone = cloneNode(element, true);

// The cloned element retains its custom behavior
// and options from the original
console.log(clone.options); // Preserved!
{% endhighlight %}

{{ comparisonContent("clonenode-example", code=true) }}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
    <div>
        <div style="font-size: 0.7rem; font-weight: 600; color: #059669; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f0fdf4; border-bottom: 1px solid #e5e7eb;">Plugged</div>
{% highlight "javascript" %}
// Native method, patched
const clone = el.cloneNode(true);
clone.options; // preserved
{% endhighlight %}
    </div>
    <div style="border-left: 1px solid #e5e7eb;">
        <div style="font-size: 0.7rem; font-weight: 600; color: #475569; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f8fafc; border-bottom: 1px solid #e5e7eb;">Unplugged</div>
{% highlight "javascript" %}
consume {
  cloneNode
} of '@web-components';

const clone = cloneNode(el, true);
clone.options; // preserved
{% endhighlight %}
    </div>
</div>

{{ endContent() }}

<p class="text-sm text-gray-600 mt-4">
    Without this patch, cloned nodes would lose their enhanced prototypes.
</p>
