{% from "mode-selector.njk" import pluggedContent, unpluggedContent, comparisonContent, endContent %}

<h3 id="overview">Overview</h3>
<p>
    Wraps native HTMLElement constructors to enable the dynamic registry system.
</p>

<h3 id="behavior">Behavior</h3>
<p class="text-sm text-gray-600 mb-4">
    This patch intercepts HTMLElement constructor calls to enable scoped custom element registries and dynamic element definition lookup.
</p>

<h3 id="usage-example">Usage Example</h3>

{{ pluggedContent("htmlelement-example", code=true) }}
{% highlight "javascript" %}
// HTMLElement constructors are automatically patched
class MyElement extends HTMLElement {
    connectedCallback() {
        // Has access to scoped registries
        const injector = this.getClosestInjector();
    }
}

// Native subclasses also work
class MyButton extends HTMLButtonElement {
    // Enhanced prototype chain
}
{% endhighlight %}

{{ unpluggedContent("htmlelement-example", code=true) }}
{% highlight "javascript" %}
consume {
  HTMLElement,
  getClosestInjector
} of '@web-components';

// Extend the consumed HTMLElement
class MyElement extends HTMLElement {
    connectedCallback() {
        // Use explicit function
        const injector = getClosestInjector(this);
    }
}
{% endhighlight %}

{{ comparisonContent("htmlelement-example", code=true) }}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
    <div>
        <div style="font-size: 0.7rem; font-weight: 600; color: #059669; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f0fdf4; border-bottom: 1px solid #e5e7eb;">Plugged</div>
{% highlight "javascript" %}
// Global patched
class MyEl extends HTMLElement {
  // ...
}
{% endhighlight %}
    </div>
    <div style="border-left: 1px solid #e5e7eb;">
        <div style="font-size: 0.7rem; font-weight: 600; color: #475569; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f8fafc; border-bottom: 1px solid #e5e7eb;">Unplugged</div>
{% highlight "javascript" %}
consume {
  HTMLElement
} of '@web-components';

class MyEl extends HTMLElement {
  // ...
}
{% endhighlight %}
    </div>
</div>

{{ endContent() }}
