{% from "mode-selector.njk" import pluggedContent, unpluggedContent, comparisonContent, endContent %}

<h3 id="overview">Overview</h3>
<p>
    <strong>CustomScriptType</strong> is the base class for creating custom script types. It extends <code>HTMLScriptElement</code> and provides lifecycle callbacks similar to Custom Elements.
</p>

<h3 id="interface">Interface</h3>
{% highlight "typescript" %}
abstract class CustomScriptType extends HTMLScriptElement {
    options?: Partial<CustomScriptTypeOptions>;

    static observedAttributes?: string[];

    connectedCallback?(): void;
    disconnectedCallback?(): void;
    adoptedCallback?(): void;
}
{% endhighlight %}

<h3 id="lifecycle-callbacks">Lifecycle Callbacks</h3>
<dl class="ml-4 text-sm">
    <dt class="font-bold text-gray-800 mt-3"><code>connectedCallback()</code></dt>
    <dd class="text-gray-600 ml-4">Invoked when the script element is inserted into the DOM.</dd>

    <dt class="font-bold text-gray-800 mt-3"><code>disconnectedCallback()</code></dt>
    <dd class="text-gray-600 ml-4">Invoked when the script element is removed from the DOM.</dd>
</dl>

<h3 id="usage-example">Usage Example</h3>

{{ pluggedContent("scripttype-example", code=true) }}
{% highlight "javascript" %}
class ContextScript extends CustomScriptType {
    connectedCallback() {
        // Access the script's content
        const code = this.innerHTML;

        // Attach to the nearest injector
        const injector = this.getClosestInjector();
        if (injector) {
            const registry = injector.get('customContexts');
            registry.set(this.id, eval(`(${code})`));
        }
    }
}

// Register globally
customScriptTypes.define('context', ContextScript);
{% endhighlight %}

{{ unpluggedContent("scripttype-example", code=true) }}
{% highlight "javascript" %}
consume {
  CustomScriptType,
  customScriptTypes,
  getClosestInjector
} of '@web-injectors';

class ContextScript extends CustomScriptType {
    connectedCallback() {
        const code = this.innerHTML;

        const injector = getClosestInjector(this);
        if (injector) {
            const registry = injector.get('customContexts');
            registry.set(this.id, eval(`(${code})`));
        }
    }
}

// Register via consumed registry
customScriptTypes.define('context', ContextScript);
{% endhighlight %}

{{ comparisonContent("scripttype-example", code=true) }}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
    <div>
        <div style="font-size: 0.7rem; font-weight: 600; color: #059669; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f0fdf4; border-bottom: 1px solid #e5e7eb;">Plugged</div>
{% highlight "javascript" %}
// Global availability
class CtxScript extends
  CustomScriptType {
  connectedCallback() {
    this.getClosestInjector();
  }
}

customScriptTypes.define(
  'context', CtxScript
);
{% endhighlight %}
    </div>
    <div style="border-left: 1px solid #e5e7eb;">
        <div style="font-size: 0.7rem; font-weight: 600; color: #475569; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f8fafc; border-bottom: 1px solid #e5e7eb;">Unplugged</div>
{% highlight "javascript" %}
consume {
  CustomScriptType,
  customScriptTypes,
  getClosestInjector
} of '@web-injectors';

class CtxScript extends
  CustomScriptType {
  connectedCallback() {
    getClosestInjector(this);
  }
}

customScriptTypes.define(
  'context', CtxScript
);
{% endhighlight %}
    </div>
</div>

{{ endContent() }}

<h3 id="use-cases">Use Cases</h3>
<ul class="list-disc ml-5 mb-4 text-sm text-gray-600">
    <li><strong>Injector Blocks:</strong> Declarative dependency injection</li>
    <li><strong>Context Definitions:</strong> Declarative context providers</li>
    <li><strong>Inline Modules:</strong> Importable inline JavaScript modules</li>
</ul>
