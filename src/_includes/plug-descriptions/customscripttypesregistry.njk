{% from "mode-selector.njk" import pluggedContent, unpluggedContent, comparisonContent, endContent %}

<h3 id="overview">Overview</h3>
<p>
    The <strong>CustomScriptTypesRegistry</strong> allows defining custom behavior for <code>&lt;script&gt;</code> tags with custom type attributes.
    This enables declarative scripting patterns such as injector blocks and context definitions.
</p>

<h3 id="interface">Interface</h3>
{% highlight "typescript" %}
interface CustomScriptTypesRegistry extends HTMLRegistry<
    ScriptTypeDefinition,
    ImplementedCustomScriptType
> {
    readonly localName = 'customScriptTypes';

    define(
        name: string,
        scriptType: ImplementedCustomScriptType
    ): void;

    upgrade(root: Node): void;
    downgrade(root: Node): void;
}
{% endhighlight %}

<h3 id="usage-example">Usage Example</h3>

{{ pluggedContent("scripttypes-reg-example", code=true) }}
{% highlight "javascript" %}
// Define a custom script type
class InjectorScript extends CustomScriptType {
    connectedCallback() {
        const code = this.textContent;
        // ... process injector syntax
    }
}

// Register globally
customScriptTypes.define('injector', InjectorScript);
{% endhighlight %}

{{ unpluggedContent("scripttypes-reg-example", code=true) }}
{% highlight "javascript" %}
consume {
  CustomScriptType,
  customScriptTypes
} of '@web-injectors';

// Define a custom script type
class InjectorScript extends CustomScriptType {
    connectedCallback() {
        const code = this.textContent;
        // ... process injector syntax
    }
}

// Register via consumed registry
customScriptTypes.define('injector', InjectorScript);
{% endhighlight %}

{{ comparisonContent("scripttypes-reg-example", code=true) }}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
    <div>
        <div style="font-size: 0.7rem; font-weight: 600; color: #059669; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f0fdf4; border-bottom: 1px solid #e5e7eb;">Plugged</div>
{% highlight "javascript" %}
// Global registry
customScriptTypes.define(
  'injector', InjectorScript
);
{% endhighlight %}
    </div>
    <div style="border-left: 1px solid #e5e7eb;">
        <div style="font-size: 0.7rem; font-weight: 600; color: #475569; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f8fafc; border-bottom: 1px solid #e5e7eb;">Unplugged</div>
{% highlight "javascript" %}
consume {
  customScriptTypes
} of '@web-injectors';

customScriptTypes.define(
  'injector', InjectorScript
);
{% endhighlight %}
    </div>
</div>

{{ endContent() }}

<h3 id="html-usage">HTML Usage</h3>
{% highlight "html" %}
<!-- Use in HTML with is attribute -->
<script is="injector" id="my-injector">
    provide { theme } from './theme-dark.js';
</script>
{% endhighlight %}
