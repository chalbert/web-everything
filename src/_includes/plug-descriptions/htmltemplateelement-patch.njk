{% from "mode-selector.njk" import pluggedContent, unpluggedContent, comparisonContent, endContent %}

<h3 id="overview">Overview</h3>
<p>
    Patches the <code>content</code> getter on HTMLTemplateElement to support enhanced template functionality.
</p>

<h3 id="behavior">Behavior</h3>
<p class="text-sm text-gray-600 mb-4">
    This patch ensures that:
</p>
<ul class="list-disc ml-5 mb-4 text-sm text-gray-600">
    <li>The DocumentFragment has the correct prototype</li>
    <li>The fragment maintains a reference to its owner template</li>
    <li>Template cloning preserves metadata and injector context</li>
</ul>

<h3 id="usage-example">Usage Example</h3>

{{ pluggedContent("template-example", code=true) }}
{% highlight "javascript" %}
const template = document.createElement('template');
template.innerHTML = '<my-component></my-component>';

// content is a properly enhanced DocumentFragment
const fragment = template.content;
console.log(fragment.ownerTemplate === template); // true

// Clone preserves enhanced prototypes
const clone = template.content.cloneNode(true);
{% endhighlight %}

{{ unpluggedContent("template-example", code=true) }}
{% highlight "javascript" %}
consume {
  getTemplateContent,
  getOwnerTemplate
} of '@web-components';

const template = document.createElement('template');
template.innerHTML = '<my-component></my-component>';

// Use explicit function for enhanced content
const fragment = getTemplateContent(template);
console.log(getOwnerTemplate(fragment) === template); // true
{% endhighlight %}

{{ comparisonContent("template-example", code=true) }}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
    <div>
        <div style="font-size: 0.7rem; font-weight: 600; color: #059669; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f0fdf4; border-bottom: 1px solid #e5e7eb;">Plugged</div>
{% highlight "javascript" %}
// Native property, patched
const frag = template.content;
frag.ownerTemplate; // tracked
{% endhighlight %}
    </div>
    <div style="border-left: 1px solid #e5e7eb;">
        <div style="font-size: 0.7rem; font-weight: 600; color: #475569; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f8fafc; border-bottom: 1px solid #e5e7eb;">Unplugged</div>
{% highlight "javascript" %}
consume {
  getTemplateContent,
  getOwnerTemplate
} of '@web-components';

const frag = getTemplateContent(tpl);
getOwnerTemplate(frag); // tracked
{% endhighlight %}
    </div>
</div>

{{ endContent() }}
