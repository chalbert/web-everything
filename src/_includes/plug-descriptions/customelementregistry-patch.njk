{% from "mode-selector.njk" import pluggedContent, unpluggedContent, comparisonContent, endContent %}

<h3 id="overview">Overview</h3>
<p>
    Replaces the native <code>window.customElements</code> with a version that extends <code>HTMLRegistry</code>.
    This keeps the native API compatible while unlocking scoped registries and inheritance.
</p>

<h3 id="interface">Interface</h3>
{% highlight "typescript" %}
class CustomElementRegistry extends HTMLRegistry<
    ElementDefinition,
    ImplementedElement
> {
    // Standard CustomElementRegistry API
    define(
        name: string,
        constructor: CustomElementConstructor,
        options?: ElementDefinitionOptions
    ): void;
    get(name: string): CustomElementConstructor | undefined;
    whenDefined(name: string): Promise<CustomElementConstructor>;
    upgrade(root: Node): void;
}
{% endhighlight %}

<h3 id="usage-example">Usage Example</h3>

{{ pluggedContent("element-registry-example", code=true) }}
{% highlight "javascript" %}
// Use the patched global registry
customElements.define('my-component', MyComponent);

// Works exactly like native API
const MyComp = customElements.get('my-component');
await customElements.whenDefined('my-component');

// Plus scoped registry features
const scoped = injector.get('customElements');
scoped.define('local-comp', LocalComponent);
{% endhighlight %}

{{ unpluggedContent("element-registry-example", code=true) }}
{% highlight "javascript" %}
consume {
  customElements,
  getClosestInjector
} of '@web-registries';

// Use the consumed registry
customElements.define('my-component', MyComponent);

// Same API available
const MyComp = customElements.get('my-component');

// Access scoped registries
const injector = getClosestInjector(element);
const scoped = injector.get('customElements');
{% endhighlight %}

{{ comparisonContent("element-registry-example", code=true) }}
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
    <div>
        <div style="font-size: 0.7rem; font-weight: 600; color: #059669; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f0fdf4; border-bottom: 1px solid #e5e7eb;">Plugged</div>
{% highlight "javascript" %}
// Global patched registry
customElements.define(
  'my-comp', MyComponent
);
{% endhighlight %}
    </div>
    <div style="border-left: 1px solid #e5e7eb;">
        <div style="font-size: 0.7rem; font-weight: 600; color: #475569; padding: 0.5rem 1rem; text-transform: uppercase; letter-spacing: 0.05em; background: #f8fafc; border-bottom: 1px solid #e5e7eb;">Unplugged</div>
{% highlight "javascript" %}
consume {
  customElements
} of '@web-registries';

customElements.define(
  'my-comp', MyComponent
);
{% endhighlight %}
    </div>
</div>

{{ endContent() }}

<p class="text-sm text-gray-600 mt-4">
    See <a href="/projects/webregistries/">Web Registries</a> for more information on scoped registry capabilities.
</p>
